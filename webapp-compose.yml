version: "4.00"
services:
  api:
    images: "node:18-alpine"
    container_name: "api_service"
    working_dir: "/app"
    command: "npm run start"
    volumes:
      - "/backend:/app"
    ports:
      - "4000:4000"
    environment:
      NODE_ENV: production
      REDIS_HOST: "redis"
    depends_on:
      - redis
    restart: always
  redis:
    image: "redis:7"
    container_name: "redis_cache"
    ports: "6379:6379"
    volumes:
      - "redis_data:/data"
  nginx:
    image: "nginx:alpine"
    ports: "80:80"
    volumes:
      - "./nginx.conf:/etc/nginx/nginx.conf"
    depends_on:
      - api

volumes:
  redis_data: {}
